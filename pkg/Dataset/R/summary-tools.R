totex <- function(txt){
 return(gsub("_", "\\\\_", txt, perl = T)) 
}
# totex("shp_bon")

latex.head <- function(title, latexPackages, outFileCon){
  cat("\\documentclass[landscape]{article} \n" , file = outFileCon, append = F)
  cat("\\usepackage[top=2.5cm, bottom=2.5cm, left=1.5cm, right=1.5cm]{geometry} \n", file = outFileCon, append = T)
  
  cat("\\usepackage[utf8]{inputenc} \n", file = outFileCon, append = T)
  
  latex.write.packages(latexPackages, outFileCon)
  
  #cat("\\usepackage[utf8x]{inputenc} \n", file = outFileCon, append = T)
  cat("\\usepackage[T1]{fontenc} \n", file = outFileCon, append = T)
  #cat("\\usepackage{aeguill}  \n", file = outFileCon, append = T)
  cat("\\usepackage{longtable} \n", file = outFileCon, append = T)
  cat("\\usepackage{graphicx} \n", file = outFileCon, append = T)
  
  cat("\\author{Generated by the R Dataset package} \n", file = outFileCon, append = T)
	cat("\\title{", title, "} \n", file = outFileCon, append = T)
	cat("\\begin{document} \n", file = outFileCon, append = T)
	cat("\\maketitle \n", file = outFileCon, append = T)
}

latex.write.packages <- function(packages, outFileCon){
  if(!is.null(packages)) {
    stopifnot(inherits(packages, "character"))
    packages <- unique(packages)
    for (i in 1:length(packages)) {
      cat("\\usepackage", packages[i], " \n", file = outFileCon, append = T, sep="")
    }
  }
}


close.and.clean <- function(outFileCon, pdfSavingName, keepTex){
  cat("\\end{document} \n", file = outFileCon, append = T)
  close(outFileCon)
  tools::texi2pdf(paste(pdfSavingName, '.tex', sep = ''))
  
  # clean directory
  if (keepTex) {
    extensionsToRemove <- ".(log|aux)"
  } else {
    extensionsToRemove <- ".(log|aux|tex)"
  }
  
  tempTex <- list.files(
    ##paste(datadir, wavesFolder, "-SPSS", "/", i, sep = ""),
    getwd(),
    pattern = paste("^", pdfSavingName, extensionsToRemove, sep = "")
  )
  
  unlink(tempTex)
}

# v a Variable
str.typevar <- function(x, short = FALSE, parenthesis=FALSE) {
  if (parenthesis) {
    txt.before <- '('
    txt.after <- ')'
  } else {
    txt.before <- txt.after <- ''
  }
  
 if(is.nominal(x)) {
   if (short) txt <- 'n'
   else txt <- 'nominal'
 }
 if(is.ordinal(x)) {
   if (short) txt <- 'o'
   else txt <- 'ordinal'
 }
 if(is.binary(x)) {
   if (short) txt <- 'b'
   else txt <- 'binary'
 }
 if(is.scale(x)) {
   if (short) txt <- 's'
   else txt <- 'scale'
 }
 if(is.time(x)) {
   if (short) txt <- 't'
   else txt <- 'time'
 }
 if(is.weighting(x)) {
   if (short) txt <- 'w'
   else txt <- 'weighting'
 }
  
  return(paste(txt.before, txt, txt.after, sep = ''))
}
# str.typevar(svar(c(1)))
# str.typevar(svar(c(1)), short = T)

str.collapse <- function(x,y, sep = ' ') {
  out <- mapply(paste, x, y, sep=sep)
  names(out) <- NULL
  return(out)
}
# str.collapse(c("id", "health"), c("s", "o"))

#x a Dataset
str.names <- function(x, parenthesis=TRUE, sep = ' ') {
  out <- mapply(str.typevar, variables(x), parenthesis=parenthesis)
  out <- str.collapse(names(x), unlist(out), sep = sep)
  return(out)
}
# str.names(z, parenthesis = T)

